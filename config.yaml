# Configuration for keyboard layout analysis pipeline

#========#
# Inputs #
#========#
data:
  input_file: "data/input/output_all4studies_406participants/tables/filtered_bigram_data.csv"
  # Alternative input files:
  # input_file: "data/input/output_all4studies_406participants/tables/filtered_consistent_choices.csv"
  # input_file: "data/input/output_all4studies_303of406participants_0improbable/tables/filtered_bigram_data.csv"
  # input_file: "data/input/output_all4studies_303of406participants_0improbable/tables/filtered_consistent_choices.csv"

# Generate and save train/test participant splits
splits:
  generate_splits: false  # Generate and save train/test splits?
  train_ratio: 0.8      # Proportion of participants for training the Bayesian model
  splits_file: "data/splits/train_test_indices.npz"

# Keyboard layout settings
layout:
  left_chars: ['q', 'w', 'e', 'r', 't', 'a', 's', 'd', 'f', 'g', 'z', 'x', 'c', 'v', 'b']

#===================#
# Function settings #
#===================#
# Feature evaluation settings
feature_evaluation:
  enabled: false
  n_splits: 5
  n_samples: 1000
  test_size: 0.2
  # List of feature combinations to evaluate
  combinations:
    - ['same_finger', 'adjacent_finger', 'adj_finger_diff_row', 'adj_finger_skip',
       'rows_apart', 'skip_home', 'columns_apart', 'angle_apart',
       'outward_roll', 'outward_roll_same_row', 'outward_skip',
       'middle_column', 'sum_engram_position_values', 'sum_row_position_values',
       'sum_finger_values', 'finger1or4_top_above', 'finger2or3_bottom_below', 'finger_pairs']
    - ['same_finger', 'adj_finger_skip', 'skip_home', 'angle_apart', 'outward_roll_same_row',
       'middle_column', 'sum_engram_position_values', 'sum_row_position_values',
       'sum_finger_values', 'finger1or4_top_above', 'finger2or3_bottom_below']

# Model settings
model:
  train: false
  inference_method: 'mcmc'  # or 'variational'
  num_samples: 2000
  chains: 8
  evaluate_test: true    # Whether to evaluate model on test set
  scoring:
    enabled: true
    mirror_left_right_scores: true
  visualization:
    enabled: true

# Logging settings
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "output/logs/pipeline.log"

#==================#
# Feature settings #
#==================#
features:
  all_features:
    # Qwerty bigram frequency and typing time features
    - 'qwerty_bigram_frequency'
    - 'typing_time'
    # Same features
      #- 'same_hand'
    - 'same_finger'
      #- 'same_key'
    # Adjacent features 
    - 'adjacent_finger'
    - 'adj_finger_diff_row'
    - 'adj_finger_skip'
    # Separation features
    - 'rows_apart'
    - 'skip_home'
    - 'columns_apart'
      #- 'distance_apart'
    - 'angle_apart'
    # Direction features
    - 'outward_roll'
    - 'outward_roll_same_row'
    - 'outward_skip'
    # Position features
    - 'middle_column'
    - 'sum_engram_position_values'
    - 'sum_row_position_values'
    # Finger features
    - 'sum_finger_values'
    - 'finger1or4_top_above'
    - 'finger2or3_bottom_below'
    - 'finger_pairs'

  # Group features by their role
  groups:
    design:
      # Same features
      - 'same_finger'
      # Adjacent features 
      - 'adjacent_finger'
      - 'adj_finger_diff_row'
      - 'adj_finger_skip'
      # Separation features
      - 'rows_apart'
      - 'skip_home'
      - 'columns_apart'
      - 'distance_apart'
      - 'angle_apart'
      # Direction features
      - 'outward_roll'
      - 'outward_roll_same_row'
      - 'outward_skip'
      # Position features
      - 'middle_column'
      - 'sum_engram_position_values'
      - 'sum_row_position_values'
      # Finger features
      - 'sum_finger_values'
      - 'finger1or4_top_above'
      - 'finger2or3_bottom_below'
      - 'finger_pairs'
    control:
      - 'qwerty_bigram_frequency'
      - 'typing_time'
  
  # Feature interactions to consider
  interactions:
    enabled: true
    pairs:
      - ['adjacent_finger', 'skip_home']

#============================#
# Output directory structure #
#============================#
output:
  base_dir: "output"
  logs: "output/logs"
  
  # Feature evaluation outputs
  feature_evaluation:
    dir: "output/feature_evaluation"
  
  # Model outputs
  model:
    dir: "output/model"
    results: "output/model/results"
    diagnostics: "output/model/diagnostics_{inference_method}.png"
    forest: "output/model/forest_{inference_method}.png"
    posterior: "output/model/posterior_{inference_method}.png"
    participant_effects: "output/model/participant_effects_{inference_method}.png"
    sensitivity: "output/model/sensitivity_{inference_method}.png"
  
  # Feature space analysis
  feature_space:
    enabled: true
    check_multicollinearity: true
    recommend_bigrams: true
    num_recommendations: 30
    dir: "output/feature_space"
    analysis: "output/feature_space/analysis.txt"
    recommendations: "output/feature_space/recommendations.txt"
    pca: "output/feature_space/pca.png"
    bigram_graph: "output/feature_space/bigram_graph.png"
    underrepresented: "output/feature_space/underrepresented.png"
  
  # Timing frequency analysis
  frequency_timing:
    enabled: true  # Master switch for frequency/timing analysis
    n_groups: 4
    dir: "output/frequency_timing"
    analysis: "output/frequency_timing/analysis.txt"
    relationship: "output/frequency_timing/relationship.png"
    group_directory: "output/frequency_timing/groups"

  # Comfort scores
  scores: "output/scores/bigram_comfort_scores.csv"
